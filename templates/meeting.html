{% extends "base.html" %}

{% block title %}Meeting Room{% endblock %}

{% block content %}
<div class="meeting-container">
    <div class="meeting-header">
        <h2>Meeting with {{ advocate.name }}</h2>
        <div class="meeting-info">
            <p><strong>Client:</strong> {{ meeting.client_name }}</p>
            <p><strong>Date:</strong> {{ meeting.date }} at {{ meeting.time }}</p>
            <p><strong>Meeting ID:</strong> {{ meeting.id }}</p>
        </div>
    </div>

    <div id="jitsi-container" class="video-container">
        <!-- Jitsi Meet will be embedded here -->
    </div>

    <div class="meeting-controls">
        <button onclick="window.close()" class="btn-close">
            <i class="fas fa-times"></i> End Meeting
        </button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize Jitsi Meet
const domain = 'meet.jit.si';
const options = {
    roomName: '{{ meeting.room_name }}',
    width: '100%',
    height: 500,
    parentNode: document.querySelector('#jitsi-container'),
    userInfo: {
        displayName: '{{ meeting.client_name }}'
    },
    configOverwrite: {
        startWithAudioMuted: true,
        startWithVideoMuted: false,
        prejoinPageEnabled: false
    },
    interfaceConfigOverwrite: {
        TOOLBAR_BUTTONS: [
            'microphone', 'camera', 'closedcaptions', 'desktop', 'fullscreen',
            'fodeviceselection', 'hangup', 'profile', 'chat', 'recording',
            'livestreaming', 'etherpad', 'sharedvideo', 'settings', 'raisehand',
            'videoquality', 'filmstrip', 'invite', 'feedback', 'stats', 'shortcuts',
            'tileview', 'videobackgroundblur', 'download', 'help', 'mute-everyone'
        ]
    }
};

const api = new JitsiMeetExternalAPI(domain, options);

// Event listeners
api.addEventListener('videoConferenceJoined', () => {
    console.log('Joined the meeting');
});

api.addEventListener('videoConferenceLeft', () => {
    console.log('Left the meeting');
    window.close();
});
</script>
{% endblock %}
