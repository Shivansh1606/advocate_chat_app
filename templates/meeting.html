{% extends "base.html" %}

{% block title %}Schedule Meeting - {{ advocate.name }}{% endblock %}

{% block content %}
<div class="container">
    <div class="meeting-wrapper">
        <!-- Elegant Header -->
        <div class="meeting-hero">
            <div class="hero-background"></div>
            <div class="hero-content">
                <div class="advocate-profile-card">
                    <div class="advocate-avatar">
                        <i class="fas fa-user-tie"></i>
                        <div class="verified-badge">
                            <i class="fas fa-check"></i>
                        </div>
                    </div>
                    <div class="advocate-info">
                        <h1>Schedule with {{ advocate.name }}</h1>
                        <div class="advocate-credentials">
                            <span class="credential">{{ advocate.specialty }}</span>
                            <span class="separator">•</span>
                            <span class="credential">{{ advocate.experience }}</span>
                            <span class="separator">•</span>
                            <div class="rating">
                                <i class="fas fa-star"></i>
                                <span>{{ advocate.rating }}</span>
                            </div>
                        </div>
                        <p class="advocate-description">Professional legal consultation with experienced advocacy</p>
                    </div>
                </div>
                
                <div class="navigation-controls">
                    <a href="/chat?advocate={{ advocate.id }}" class="nav-btn chat-nav">
                        <i class="fas fa-comments"></i>
                        <span>Continue Chat</span>
                    </a>
                    <a href="/" class="nav-btn home-nav">
                        <i class="fas fa-home"></i>
                        <span>Home</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Smart Booking Form -->
        <div class="booking-container" id="booking-container">
            <div class="booking-progress">
                <div class="progress-bar">
                    <div class="progress-step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Personal Info</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Schedule</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Case Details</div>
                    </div>
                    <div class="progress-line"></div>
                    <div class="progress-step" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-label">Confirmation</div>
                    </div>
                </div>
            </div>

            <form class="smart-form" id="meetingForm">
                <!-- Step 1: Personal Information -->
                <div class="form-step active" id="step-1">
                    <div class="step-header">
                        <h2><i class="fas fa-user-circle"></i> Personal Information</h2>
                        <p>Please provide your contact details for the meeting</p>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="client-name">
                                <i class="fas fa-user"></i>
                                Full Name *
                            </label>
                            <input type="text" id="client-name" name="clientName" required placeholder="Enter your full name">
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="client-email">
                                <i class="fas fa-envelope"></i>
                                Email Address *
                            </label>
                            <input type="email" id="client-email" name="clientEmail" required placeholder="your.email@example.com">
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="client-phone">
                                <i class="fas fa-phone"></i>
                                Phone Number *
                            </label>
                            <input type="tel" id="client-phone" name="clientPhone" required placeholder="+91 9876543210">
                            <div class="input-feedback"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="client-city">
                                <i class="fas fa-map-marker-alt"></i>
                                City
                            </label>
                            <input type="text" id="client-city" name="clientCity" placeholder="Your city">
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn-next" onclick="nextStep()">
                            <span>Next Step</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 2: Meeting Schedule -->
                <div class="form-step" id="step-2">
                    <div class="step-header">
                        <h2><i class="fas fa-calendar-check"></i> Meeting Schedule</h2>
                        <p>Choose your preferred date and time for consultation</p>
                    </div>
                    
                    <div class="schedule-selector">
                        <div class="date-picker-section">
                            <label for="meeting-date">
                                <i class="fas fa-calendar"></i>
                                Preferred Date *
                            </label>
                            <input type="date" id="meeting-date" name="meetingDate" required>
                            <div class="date-info">
                                <small><i class="fas fa-info-circle"></i> Available Monday to Saturday, 9:00 AM to 6:00 PM</small>
                            </div>
                        </div>
                        
                        <div class="time-slots-section">
                            <label>
                                <i class="fas fa-clock"></i>
                                Available Time Slots *
                            </label>
                            <div class="time-slots-grid" id="time-slots">
                                <!-- Time slots will be generated by JavaScript -->
                            </div>
                            <input type="hidden" id="meeting-time" name="meetingTime" required>
                        </div>
                    </div>
                    
                    <div class="meeting-options">
                        <div class="form-group">
                            <label for="meeting-type">
                                <i class="fas fa-video"></i>
                                Meeting Type *
                            </label>
                            <div class="meeting-type-cards">
                                <div class="type-card recommended" data-type="video-call">
                                    <div class="type-icon">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <div class="type-info">
                                        <h4>Video Call</h4>
                                        <p>Best for detailed discussions</p>
                                        <span class="badge">Recommended</span>
                                    </div>
                                </div>
                                
                                <div class="type-card" data-type="phone-call">
                                    <div class="type-icon">
                                        <i class="fas fa-phone"></i>
                                    </div>
                                    <div class="type-info">
                                        <h4>Phone Call</h4>
                                        <p>Audio consultation</p>
                                    </div>
                                </div>
                                
                                <div class="type-card" data-type="in-person">
                                    <div class="type-icon">
                                        <i class="fas fa-handshake"></i>
                                    </div>
                                    <div class="type-info">
                                        <h4>In-Person</h4>
                                        <p>Face-to-face meeting</p>
                                    </div>
                                </div>
                            </div>
                            <input type="hidden" id="meeting-type" name="meetingType" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="meeting-duration">
                                <i class="fas fa-hourglass-half"></i>
                                Expected Duration
                            </label>
                            <select id="meeting-duration" name="meetingDuration">
                                <option value="30">30 Minutes</option>
                                <option value="45" selected>45 Minutes</option>
                                <option value="60">1 Hour</option>
                                <option value="90">1.5 Hours</option>
                                <option value="120">2 Hours</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn-prev" onclick="prevStep()">
                            <i class="fas fa-arrow-left"></i>
                            <span>Previous</span>
                        </button>
                        <button type="button" class="btn-next" onclick="nextStep()">
                            <span>Next Step</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Case Details -->
                <div class="form-step" id="step-3">
                    <div class="step-header">
                        <h2><i class="fas fa-gavel"></i> Legal Matter Details</h2>
                        <p>Help us understand your legal needs better</p>
                    </div>
                    
                    <div class="case-details-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="case-type">
                                    <i class="fas fa-tags"></i>
                                    Legal Matter Type
                                </label>
                                <select id="case-type" name="caseType">
                                    <option value="">Select Case Type</option>
                                    <option value="criminal">Criminal Law</option>
                                    <option value="family">Family Law (Divorce, Custody)</option>
                                    <option value="corporate">Corporate & Business Law</option>
                                    <option value="property">Property & Real Estate</option>
                                    <option value="civil">Civil Disputes</option>
                                    <option value="consumer">Consumer Protection</option>
                                    <option value="labor">Labor & Employment</option>
                                    <option value="tax">Tax & Financial</option>
                                    <option value="immigration">Immigration</option>
                                    <option value="other">Other Legal Matter</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="urgency">
                                    <i class="fas fa-exclamation-circle"></i>
                                    Urgency Level
                                </label>
                                <div class="urgency-selector">
                                    <div class="urgency-option" data-urgency="low">
                                        <div class="urgency-indicator low"></div>
                                        <div class="urgency-info">
                                            <strong>Low</strong>
                                            <span>General consultation</span>
                                        </div>
                                    </div>
                                    <div class="urgency-option active" data-urgency="medium">
                                        <div class="urgency-indicator medium"></div>
                                        <div class="urgency-info">
                                            <strong>Medium</strong>
                                            <span>Important matter</span>
                                        </div>
                                    </div>
                                    <div class="urgency-option" data-urgency="high">
                                        <div class="urgency-indicator high"></div>
                                        <div class="urgency-info">
                                            <strong>High</strong>
                                            <span>Urgent case</span>
                                        </div>
                                    </div>
                                    <div class="urgency-option" data-urgency="critical">
                                        <div class="urgency-indicator critical"></div>
                                        <div class="urgency-info">
                                            <strong>Critical</strong>
                                            <span>Emergency</span>
                                        </div>
                                    </div>
                                </div>
                                <input type="hidden" id="urgency" name="urgency" value="medium">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="case-description">
                                <i class="fas fa-file-alt"></i>
                                Case Description
                            </label>
                            <textarea id="case-description" name="caseDescription" rows="4" 
                                      placeholder="Please provide a brief description of your legal matter, any documents you have, and specific questions you'd like to discuss..." 
                                      maxlength="2000"></textarea>
                            <div class="char-counter">
                                <span id="desc-counter">0/2000 characters</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="previous-legal-action">
                                <i class="fas fa-history"></i>
                                Previous Legal Action
                            </label>
                            <select id="previous-legal-action" name="previousLegalAction">
                                <option value="no">No previous legal action</option>
                                <option value="consultation">Previous consultation only</option>
                                <option value="case-filed">Case already filed</option>
                                <option value="ongoing-case">Ongoing legal proceedings</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="special-requirements">
                                <i class="fas fa-clipboard-list"></i>
                                Special Requirements
                            </label>
                            <textarea id="special-requirements" name="specialRequirements" rows="2" 
                                      placeholder="Any special requirements, accessibility needs, language preferences, etc." 
                                      maxlength="500"></textarea>
                            <div class="char-counter">
                                <span id="req-counter">0/500 characters</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step-actions">
                        <button type="button" class="btn-prev" onclick="prevStep()">
                            <i class="fas fa-arrow-left"></i>
                            <span>Previous</span>
                        </button>
                        <button type="submit" class="btn-submit" id="submit-btn">
                            <i class="fas fa-calendar-check"></i>
                            <span>Schedule Meeting</span>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Success Confirmation -->
        <div class="success-container" id="success-container" style="display: none;">
            <div class="success-animation">
                <div class="success-checkmark">
                    <i class="fas fa-check"></i>
                </div>
                <div class="success-rings"></div>
            </div>
            
            <div class="success-content">
                <h2>Meeting Scheduled Successfully!</h2>
                <p>Your consultation with <strong>{{ advocate.name }}</strong> has been confirmed</p>
                
                <div class="booking-summary" id="booking-summary">
                    <!-- Populated by JavaScript -->
                </div>
                
                <div class="next-steps-card">
                    <h4><i class="fas fa-road"></i> What's Next?</h4>
                    <div class="steps-timeline">
                        <div class="timeline-step">
                            <div class="step-dot">1</div>
                            <div class="step-content">
                                <strong>Email Confirmation</strong>
                                <span>You'll receive confirmation within 15 minutes</span>
                            </div>
                        </div>
                        <div class="timeline-step">
                            <div class="step-dot">2</div>
                            <div class="step-content">
                                <strong>Case Review</strong>
                                <span>Advocate will review your case details</span>
                            </div>
                        </div>
                        <div class="timeline-step">
                            <div class="step-dot">3</div>
                            <div class="step-content">
                                <strong>Meeting Link</strong>
                                <span>Calendar invite with meeting link will be sent</span>
                            </div>
                        </div>
                        <div class="timeline-step">
                            <div class="step-dot">4</div>
                            <div class="step-content">
                                <strong>Preparation</strong>
                                <span>Prepare documents and questions for discussion</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="success-actions">
                    <button class="btn-primary" onclick="location.href='/chat?advocate={{ advocate.id }}'">
                        <i class="fas fa-comments"></i>
                        Continue Chat
                    </button>
                    <button class="btn-secondary" onclick="location.href='/'">
                        <i class="fas fa-home"></i>
                        Back to Home
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* ===== MEETING WRAPPER ===== */
.meeting-wrapper {
    max-width: 1000px;
    margin: 0 auto;
    background: white;
    border-radius: 24px;
    overflow: hidden;
    box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    border: 1px solid rgba(0,0,0,0.05);
}

/* ===== HERO SECTION ===== */
.meeting-hero {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 50px;
    position: relative;
    overflow: hidden;
}

.hero-background {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 200" fill="rgba(255,255,255,0.1)"><path d="M0,100 C300,200 700,0 1000,100 L1000,0 L0,0 Z"/></svg>');
    pointer-events: none;
}

.hero-content {
    position: relative;
    z-index: 2;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.advocate-profile-card {
    display: flex;
    align-items: center;
    gap: 25px;
}

.advocate-avatar {
    width: 90px;
    height: 90px;
    background: rgba(255,255,255,0.2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.5rem;
    position: relative;
    backdrop-filter: blur(10px);
    border: 3px solid rgba(255,255,255,0.3);
}

.verified-badge {
    position: absolute;
    bottom: -5px;
    right: -5px;
    width: 25px;
    height: 25px;
    background: #4CAF50;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid white;
    font-size: 0.8rem;
}

.advocate-info h1 {
    font-size: 2rem;
    font-weight: 600;
    margin-bottom: 12px;
}

.advocate-credentials {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}

.credential {
    background: rgba(255,255,255,0.2);
    padding: 6px 15px;
    border-radius: 15px;
    font-size: 0.85rem;
    font-weight: 500;
}

.separator {
    opacity: 0.6;
}

.rating {
    display: flex;
    align-items: center;
    gap: 5px;
    background: rgba(255,255,255,0.2);
    padding: 6px 15px;
    border-radius: 15px;
    font-size: 0.85rem;
}

.rating i {
    color: #FFD700;
}

.advocate-description {
    opacity: 0.9;
    font-size: 1rem;
    line-height: 1.5;
    max-width: 400px;
}

.navigation-controls {
    display: flex;
    gap: 15px;
}

.nav-btn {
    background: rgba(255,255,255,0.15);
    border: 2px solid rgba(255,255,255,0.25);
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.nav-btn:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
}

/* ===== BOOKING CONTAINER ===== */
.booking-container {
    padding: 50px;
}

/* ===== PROGRESS BAR ===== */
.booking-progress {
    margin-bottom: 50px;
}

.progress-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 600px;
    margin: 0 auto;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    opacity: 0.5;
    transition: all 0.3s ease;
}

.progress-step.active {
    opacity: 1;
}

.progress-step.completed {
    opacity: 1;
}

.step-number {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #e0e0e0;
    color: #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}

.progress-step.active .step-number {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
}

.progress-step.completed .step-number {
    background: #4CAF50;
    color: white;
}

.step-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: #666;
    text-align: center;
}

.progress-line {
    flex: 1;
    height: 2px;
    background: #e0e0e0;
    margin: 0 20px;
    position: relative;
    top: -20px;
}

.progress-line.completed {
    background: #4CAF50;
}

/* ===== FORM STEPS ===== */
.form-step {
    display: none;
    animation: fadeInUp 0.5s ease;
}

.form-step.active {
    display: block;
}

@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
}

.step-header {
    text-align: center;
    margin-bottom: 40px;
}

.step-header h2 {
    color: #333;
    font-size: 1.8rem;
    font-weight: 600;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.step-header h2 i {
    color: #667eea;
    font-size: 1.5rem;
}

.step-header p {
    color: #666;
    font-size: 1rem;
    max-width: 500px;
    margin: 0 auto;
}

/* ===== FORM STYLING ===== */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.form-group {
    position: relative;
}

.form-group label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: #333;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.form-group label i {
    color: #667eea;
    font-size: 0.9rem;
    width: 16px;
}

.form-group input,
.form-group textarea,
.form-group select {
    width: 100%;
    padding: 16px 20px;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.3s ease;
    background: #f9f9f9;
    outline: none;
}

.form-group input:focus,
.form-group textarea:focus,
.form-group select:focus {
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 6px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
}

.input-feedback {
    margin-top: 8px;
    font-size: 0.8rem;
    min-height: 20px;
}

.input-feedback.success {
    color: #4CAF50;
}

.input-feedback.error {
    color: #f44336;
}

/* ===== TIME SLOTS ===== */
.schedule-selector {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 40px;
    margin-bottom: 40px;
}

.date-picker-section,
.time-slots-section {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 15px;
    border: 2px solid rgba(102, 126, 234, 0.1);
}

.date-info {
    margin-top: 10px;
}

.date-info small {
    color: #666;
    display: flex;
    align-items: center;
    gap: 6px;
}

.time-slots-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px;
    margin-top: 15px;
}

.time-slot {
    padding: 12px;
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    font-weight: 500;
}

.time-slot:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.time-slot.selected {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
}

.time-slot.unavailable {
    background: #f5f5f5;
    color: #999;
    cursor: not-allowed;
    opacity: 0.5;
}

/* ===== MEETING TYPE CARDS ===== */
.meeting-type-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 15px;
}

.type-card {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 15px;
    padding: 25px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    position: relative;
}

.type-card:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
    transform: translateY(-2px);
}

.type-card.selected {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.1);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
}

.type-card.recommended::before {
    content: 'Recommended';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: #4CAF50;
    color: white;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 600;
}

.type-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 15px;
    color: white;
    font-size: 1.3rem;
}

.type-info h4 {
    color: #333;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.type-info p {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.badge {
    background: #4CAF50;
    color: white;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
}

/* ===== URGENCY SELECTOR ===== */
.urgency-selector {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-top: 15px;
}

.urgency-option {
    background: white;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 12px;
}

.urgency-option:hover {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.05);
}

.urgency-option.active {
    border-color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

.urgency-indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    flex-shrink: 0;
}

.urgency-indicator.low { background: #4CAF50; }
.urgency-indicator.medium { background: #FF9800; }
.urgency-indicator.high { background: #f44336; }
.urgency-indicator.critical { background: #9C27B0; }

.urgency-info strong {
    display: block;
    font-size: 0.9rem;
    color: #333;
}

.urgency-info span {
    font-size: 0.75rem;
    color: #666;
}

/* ===== CHARACTER COUNTERS ===== */
.char-counter {
    text-align: right;
    margin-top: 8px;
}

.char-counter span {
    font-size: 0.8rem;
    color: #999;
}

.char-counter.warning span {
    color: #FF9800;
}

.char-counter.danger span {
    color: #f44336;
}

/* ===== STEP ACTIONS ===== */
.step-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 50px;
    gap: 20px;
}

.btn-prev, .btn-next, .btn-submit {
    padding: 16px 32px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.btn-prev {
    background: #f5f5f5;
    color: #666;
    border: 2px solid #e0e0e0;
}

.btn-prev:hover {
    background: #e0e0e0;
    transform: translateY(-2px);
}

.btn-next, .btn-submit {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    margin-left: auto;
}

.btn-next:hover, .btn-submit:hover {
    background: linear-gradient(135deg, #764ba2, #667eea);
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}

/* ===== SUCCESS CONTAINER ===== */
.success-container {
    padding: 80px 50px;
    text-align: center;
    background: linear-gradient(135deg, rgba(76, 175, 80, 0.05), rgba(102, 126, 234, 0.05));
}

.success-animation {
    position: relative;
    margin-bottom: 40px;
}

.success-checkmark {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    color: white;
    font-size: 3rem;
    animation: successPop 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
    z-index: 2;
}

.success-rings {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    border: 3px solid rgba(76, 175, 80, 0.3);
    border-radius: 50%;
    animation: ripple 2s ease-out infinite;
}

.success-rings::before {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    border: 3px solid rgba(76, 175, 80, 0.2);
    border-radius: 50%;
    animation: ripple 2s ease-out infinite 0.5s;
}

@keyframes successPop {
    0% { transform: scale(0); opacity: 0; }
    50% { transform: scale(1.2); opacity: 0.8; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes ripple {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
}

.success-content h2 {
    color: #333;
    font-size: 2.2rem;
    font-weight: 600;
    margin-bottom: 15px;
}

.success-content p {
    color: #666;
    font-size: 1.2rem;
    margin-bottom: 40px;
}

.booking-summary {
    background: white;
    border-radius: 20px;
    padding: 35px;
    margin-bottom: 40px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.08);
    border: 2px solid rgba(102, 126, 234, 0.1);
}

.next-steps-card {
    background: rgba(102, 126, 234, 0.05);
    border-radius: 20px;
    padding: 35px;
    margin-bottom: 40px;
    border: 2px solid rgba(102, 126, 234, 0.1);
}

.next-steps-card h4 {
    color: #667eea;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.steps-timeline {
    display: grid;
    gap: 20px;
    text-align: left;
}

.timeline-step {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 20px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
}

.step-dot {
    width: 35px;
    height: 35px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    flex-shrink: 0;
}

.step-content strong {
    display: block;
    color: #333;
    font-size: 1rem;
    margin-bottom: 5px;
}

.step-content span {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.4;
}

.success-actions {
    display: flex;
    justify-content: center;
    gap: 25px;
    flex-wrap: wrap;
}

.btn-primary, .btn-secondary {
    padding: 16px 32px;
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 10px;
    min-width: 180px;
    justify-content: center;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
}

.btn-primary:hover {
    background: linear-gradient(135deg, #764ba2, #667eea);
    transform: translateY(-3px);
    box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
}

.btn-secondary {
    background: #f5f5f5;
    color: #666;
    border: 2px solid #e0e0e0;
}

.btn-secondary:hover {
    background: #e0e0e0;
    transform: translateY(-2px);
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .meeting-hero {
        padding: 30px;
    }
    
    .hero-content {
        flex-direction: column;
        gap: 25px;
        text-align: center;
    }
    
    .advocate-profile-card {
        flex-direction: column;
        text-align: center;
    }
    
    .advocate-credentials {
        justify-content: center;
    }
    
    .booking-container,
    .success-container {
        padding: 30px 25px;
    }
    
    .form-grid,
    .form-row {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .schedule-selector {
        grid-template-columns: 1fr;
        gap: 25px;
    }
    
    .meeting-type-cards {
        grid-template-columns: 1fr;
    }
    
    .urgency-selector {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .step-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .success-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .timeline-step {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
}
</style>

<script>
let currentStep = 1;
const totalSteps = 4;

// Initialize form
document.addEventListener('DOMContentLoaded', function() {
    initializeForm();
    generateTimeSlots();
    setupValidation();
    setupCharacterCounters();
});

function initializeForm() {
    // Auto-fill client information if available
    const clientName = localStorage.getItem('clientName');
    const clientPhone = localStorage.getItem('clientPhone');
    const clientCity = localStorage.getItem('clientCity');
    
    if (clientName) document.getElementById('client-name').value = clientName;
    if (clientPhone) document.getElementById('client-phone').value = clientPhone;
    if (clientCity) document.getElementById('client-city').value = clientCity;
    
    // Set date constraints
    const today = new Date();
    const minDate = new Date(today.getTime() + 24 * 60 * 60 * 1000); // Tomorrow
    const maxDate = new Date(today.getTime() + 90 * 24 * 60 * 60 * 1000); // 3 months
    
    document.getElementById('meeting-date').min = minDate.toISOString().split('T')[0];
    document.getElementById('meeting-date').max = maxDate.toISOString().split('T')[0];
}

function generateTimeSlots() {
    const slotsContainer = document.getElementById('time-slots');
    const timeSlots = [
        '09:00', '09:30', '10:00', '10:30', '11:00', '11:30',
        '12:00', '14:00', '14:30', '15:00', '15:30', '16:00',
        '16:30', '17:00', '17:30', '18:00'
    ];
    
    slotsContainer.innerHTML = '';
    
    timeSlots.forEach(time => {
        const slotElement = document.createElement('div');
        slotElement.className = 'time-slot';
        slotElement.textContent = formatTimeDisplay(time);
        slotElement.onclick = () => selectTimeSlot(slotElement, time);
        slotsContainer.appendChild(slotElement);
    });
}

function selectTimeSlot(element, time) {
    // Remove previous selection
    document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // Select new slot
    element.classList.add('selected');
    document.getElementById('meeting-time').value = time;
}

function formatTimeDisplay(time) {
    const [hours, minutes] = time.split(':');
    const hour = parseInt(hours);
    const ampm = hour >= 12 ? 'PM' : 'AM';
    const displayHour = hour % 12 || 12;
    return `${displayHour}:${minutes} ${ampm}`;
}

// Meeting type selection
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.type-card').forEach(card => {
        card.addEventListener('click', function() {
            document.querySelectorAll('.type-card').forEach(c => c.classList.remove('selected'));
            this.classList.add('selected');
            document.getElementById('meeting-type').value = this.dataset.type;
        });
    });
    
    // Urgency selection
    document.querySelectorAll('.urgency-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.urgency-option').forEach(o => o.classList.remove('active'));
            this.classList.add('active');
            document.getElementById('urgency').value = this.dataset.urgency;
        });
    });
});

function setupCharacterCounters() {
    setupCounter('case-description', 'desc-counter', 2000);
    setupCounter('special-requirements', 'req-counter', 500);
}

function setupCounter(textareaId, counterId, maxLength) {
    const textarea = document.getElementById(textareaId);
    const counter = document.getElementById(counterId);
    
    textarea.addEventListener('input', function() {
        const length = this.value.length;
        counter.textContent = `${length}/${maxLength} characters`;
        
        const counterContainer = counter.parentElement;
        if (length > maxLength * 0.9) {
            counterContainer.className = 'char-counter danger';
        } else if (length > maxLength * 0.8) {
            counterContainer.className = 'char-counter warning';
        } else {
            counterContainer.className = 'char-counter';
        }
    });
}

function setupValidation() {
    // Real-time validation for all form fields
    const inputs = document.querySelectorAll('input, textarea, select');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            if (this.classList.contains('invalid')) {
                validateField(this);
            }
        });
    });
}

function validateField(field) {
    const feedback = field.parentNode.querySelector('.input-feedback');
    if (!feedback) return;
    
    let isValid = true;
    let message = '';
    
    // Reset styles
    field.style.borderColor = '#e0e0e0';
    field.classList.remove('invalid', 'valid');
    feedback.className = 'input-feedback';
    
    // Validation logic
    if (field.hasAttribute('required') && !field.value.trim()) {
        isValid = false;
        message = 'This field is required';
    } else if (field.value.trim()) {
        switch (field.type) {
            case 'email':
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(field.value)) {
                    isValid = false;
                    message = 'Please enter a valid email address';
                }
                break;
            case 'tel':
                if (!/^[\+]?[0-9\s\-\(\)]{10,}$/.test(field.value)) {
                    isValid = false;
                    message = 'Please enter a valid phone number';
                }
                break;
        }
    }
    
    // Apply validation feedback
    if (!isValid) {
        field.style.borderColor = '#f44336';
        field.classList.add('invalid');
        feedback.className = 'input-feedback error';
        feedback.textContent = message;
    } else if (field.value.trim()) {
        field.style.borderColor = '#4CAF50';
        field.classList.add('valid');
        feedback.className = 'input-feedback success';
        feedback.innerHTML = '<i class="fas fa-check"></i> Looks good!';
    } else {
        feedback.textContent = '';
    }
    
    return isValid;
}

function validateStep(step) {
    const stepElement = document.getElementById(`step-${step}`);
    const inputs = stepElement.querySelectorAll('input[required], select[required], textarea[required]');
    let isValid = true;
    
    inputs.forEach(input => {
        if (!validateField(input)) {
            isValid = false;
        }
    });
    
    return isValid;
}

function nextStep() {
    if (currentStep === 1) {
        if (!validateStep(1)) {
            showNotification('Please fill in all required fields correctly', 'warning');
            return;
        }
    }
    
    if (currentStep === 2) {
        if (!document.getElementById('meeting-time').value) {
            showNotification('Please select a time slot', 'warning');
            return;
        }
        if (!document.getElementById('meeting-type').value) {
            showNotification('Please select a meeting type', 'warning');
            return;
        }
    }
    
    if (currentStep < totalSteps) {
        // Hide current step
        document.getElementById(`step-${currentStep}`).classList.remove('active');
        
        // Update progress
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('completed');
        
        currentStep++;
        
        // Show next step
        document.getElementById(`step-${currentStep}`).classList.add('active');
        document.querySelector(`[data-step="${currentStep}"]`).classList.add('active');
        
        // Smooth scroll to top
        document.querySelector('.booking-container').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }
}

function prevStep() {
    if (currentStep > 1) {
        // Hide current step
        document.getElementById(`step-${currentStep}`).classList.remove('active');
        document.querySelector(`[data-step="${currentStep}"]`).classList.remove('active');
        
        currentStep--;
        
        // Show previous step
        document.getElementById(`step-${currentStep}`).classList.add('active');
        document.querySelector(`[data-step="${currentStep}"]`).classList.remove('completed');
        
        // Smooth scroll to top
        document.querySelector('.booking-container').scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        });
    }
}

// Form submission
document.getElementById('meetingForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    if (!validateStep(3)) {
        showNotification('Please review and complete all required fields', 'warning');
        return;
    }
    
    const submitBtn = document.getElementById('submit-btn');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Booking Meeting...</span>';
    submitBtn.disabled = true;
    
    try {
        const formData = new FormData(this);
        const meetingData = Object.fromEntries(formData);
        meetingData.advocateId = '{{ advocate.id }}';
        
        const response = await fetch('/api/book-meeting', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(meetingData)
        });
        
        const result = await response.json();
        
        if (result.status === 'success') {
            showSuccess(meetingData, result);
            showNotification('Meeting booked successfully!', 'success');
        } else {
            throw new Error(result.message || 'Booking failed');
        }
        
    } catch (error) {
        console.error('Booking error:', error);
        showNotification('Failed to book meeting. Please try again.', 'error');
        
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
    }
});

function showSuccess(data, result) {
    // Hide booking form
    document.getElementById('booking-container').style.display = 'none';
    
    // Show success container
    document.getElementById('success-container').style.display = 'block';
    
    // Populate booking summary
    const summary = document.getElementById('booking-summary');
    const meetingDate = new Date(data.meetingDate);
    const formattedDate = meetingDate.toLocaleDateString('en-IN', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    
    summary.innerHTML = `
        <div style="display: grid; gap: 20px; text-align: left;">
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 2px solid rgba(102, 126, 234, 0.1);">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-bookmark" style="color: #667eea;"></i>
                    Confirmation Number:
                </strong>
                <span style="color: #667eea; font-weight: 600; font-family: monospace; font-size: 1.1rem;">${result.confirmation_number}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-user-tie" style="color: #667eea;"></i>
                    Advocate:
                </strong>
                <span style="color: #333; font-weight: 500;">{{ advocate.name }}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-calendar" style="color: #667eea;"></i>
                    Date:
                </strong>
                <span style="color: #333; font-weight: 500;">${formattedDate}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-clock" style="color: #667eea;"></i>
                    Time:
                </strong>
                <span style="color: #333; font-weight: 500;">${formatTimeDisplay(data.meetingTime)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-video" style="color: #667eea;"></i>
                    Type:
                </strong>
                <span style="color: #333; font-weight: 500;">${formatMeetingType(data.meetingType)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px 0;">
                <strong style="color: #333; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-hourglass-half" style="color: #667eea;"></i>
                    Duration:
                </strong>
                <span style="color: #333; font-weight: 500;">${data.meetingDuration} minutes</span>
            </div>
        </div>
    `;
    
    // Scroll to success section
    document.getElementById('success-container').scrollIntoView({
        behavior: 'smooth',
        block: 'start'
    });
}

function formatMeetingType(type) {
    const types = {
        'video-call': 'Video Call',
        'phone-call': 'Phone Call',
        'in-person': 'In-Person Meeting'
    };
    return types[type] || type;
}

function showNotification(message, type) {
    if (typeof window.ChatUtils !== 'undefined' && window.ChatUtils.showNotification) {
        window.ChatUtils.showNotification(message, type);
    } else {
        console.log(`${type.toUpperCase()}: ${message}`);
    }
}
</script>
{% endblock %}
