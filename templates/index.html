{% extends "base.html" %}

{% block title %}Select Advocate - Legal Chat{% endblock %}

{% block content %}
<div class="main-container">
    <div class="header">
        <h1><i class="fas fa-gavel"></i> EaseLaw Chat System</h1>
        <p>Connect with experienced advocates for legal consultation</p>
    </div>

    <div class="client-form">
        <div class="form-group">
            <label for="client-name">Your Name</label>
            <input type="text" id="client-name" placeholder="Enter your full name" required>
        </div>
    </div>

    <div class="advocates-grid">
        <h2>Select an Advocate by Specialty</h2>
        <div class="grid" id="advocates-grid">
            <!-- Advocates will be loaded here by JavaScript -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let advocatesData = [];

async function loadAdvocates() {
    try {
        const response = await fetch('/api/advocates');
        const data = await response.json();
        advocatesData = data.advocates;
        displayAdvocates();
    } catch (error) {
        console.error('Error loading advocates:', error);
    }
}

function displayAdvocates() {
    const grid = document.getElementById('advocates-grid');
    grid.innerHTML = '';
    
    advocatesData.forEach(advocate => {
        const card = document.createElement('div');
        card.className = 'advocate-card';
        card.innerHTML = `
            <div class="advocate-header">
                <div class="advocate-avatar">
                    <i class="${advocate.avatar}"></i>
                </div>
                <div class="status-indicator ${advocate.available ? 'online' : 'offline'}"></div>
            </div>
            <div class="advocate-info">
                <h3>${advocate.name}</h3>
                <p class="specialty">${advocate.specialty}</p>
                <p class="experience">${advocate.experience} experience</p>
                <div class="rating">
                    <i class="fas fa-star"></i>
                    <span>${advocate.rating}</span>
                </div>
            </div>
            <button class="chat-btn" onclick="startChat('${advocate.id}')" 
                    ${!advocate.available ? 'disabled' : ''}>
                <i class="fas fa-comments"></i> 
                ${advocate.available ? 'Start Chat' : 'Unavailable'}
            </button>
        `;
        grid.appendChild(card);
    });
}

function startChat(advocateId) {
    const clientName = document.getElementById('client-name').value.trim();
    
    if (!clientName) {
        alert('Please enter your name first');
        return;
    }
    
    // Save client name to localStorage
    localStorage.setItem('clientName', clientName);
    
    // Navigate to chat
    window.location.href = `/chat?advocate=${advocateId}`;
}

// Load advocates on page load
window.addEventListener('DOMContentLoaded', loadAdvocates);
</script>
{% endblock %}
